{"version":3,"sources":["../../src/Subscriber.ts","../../src/Notifier.ts","../../src/Store.ts","Store.object.ts","Store.toggle.tsx","App.tsx","index.tsx"],"names":["Subscriber","createAction","get","set","value","shallow","nextValue","Object","_value","this","_listens","addListen","notify","listener","Boolean","Store","state","action","name","actions","createContext","createContainer","cycle","Context","_createAction","firePoint","fire","props","shouldComponentUpdate","next","componentWillUnmount","render","children","createElement","Component","_a","displayName","createHook","select","selector","store","useContext","useState","setState","useEffect","useObject","a","b","reset","add","key","flag","prev","useToggle","ToggleContainer","Check","toggle","setToggle","type","checked","onChange","Counter","num","onClick","App","ReactDOM","document","getElementById"],"mappings":"+lBAIaA,EAAb,YAwBE,gB,aACE,wBACA,OAAcC,EAAa,EAA3B,K,EA1BJ,kCAGE,W,WACE,MAAO,CACLC,IAAK,kBAAM,EAAN,OACLC,IAAK,YAC4B,QAA3BC,aAAJ,SAA4CA,EAAM,EAAlD,OACK,GAEPC,QAAS,YACP,MAC+BC,EAA3BF,aAAJ,SAA2CA,EAAM,EAAjD,OACKE,EACWC,OAAA,cAA4B,YAC1C,OAAOD,OAAmB,QAA1B,QAGA,QAAaC,iBAAkB,EAAlBA,MAAb,UAlBV,GCiBA,YACE,c,aACE,sBADkBC,S,EADtB,oCAKE,WACE,OAAOC,KAAP,QANJ,IASE,YACMA,KAAKD,SAAT,IACAC,KAAA,SACAA,KAAA,cAZJ,GAnBA,wBACU,KAAAC,SAAA,GADV,qCAOEC,Y,WAEE,OADAF,KAAA,iBACO,WACL,kBAAqB,mBAArB,QAVN,SAcYG,WACRH,KAAA,kBAAsB,mBAAcI,QAfxC,0BAGE,WACE,OAAOC,QAAQL,KAAKC,SAApB,YAJJ,OCiBaK,EAAb,WAIE,c,IAAcC,UAAOC,WAAQC,SAEzBT,KAAA,cADF,oBAAWQ,EACT,EAEqB,YACnB,IAAME,EAAN,GAIA,OAHAZ,wBAA4B,YAC1BY,KAAeF,KAAfE,MAEF,GAGJV,KAAA,QAAeW,wBAAc,IAAIpB,EAAWgB,EAAOP,KAAnD,gBACAA,KAAA,sBAjBJ,2CAoBEY,Y,WAAgBC,UAA2C,IACzD,IAAQC,EAAR,aAAiBC,EAAjB,mBAGA,qBAGE,c,aACE,wBAKFC,UAAY,YACVC,GAAQA,EAAK,QAAD,IAAiB,QAA7BA,SALA,QAAa,IAAI1B,EAAW2B,EAAf,MAAb,GACA,YAAeL,EAAf,Q,oCAOFM,kCACE,OAAIC,UAAepB,KAAKkB,MAAxB,QACElB,KAAA,YAAmBoB,EAAnB,MACApB,KAAA,UAAea,EAAf,SACA,I,EAKJQ,gCACErB,KAAA,UAAea,EAAf,U,EAGFS,kBACE,IAAQC,EAAavB,KAArB,eACA,OAAOwB,wBAAcV,EAAD,SAAmB,CAAEnB,MAAOK,KAAT,MAAqBuB,c,EA5BhE,CAAqBE,cACZC,YAAcZ,EAAQa,YAD/B,GAxBJ,aAyDEC,YAGE,IAAQd,EAAR,aAEMe,EAAUC,GAAa,sBAC7B,OAAO,YACL,IAAMC,EAAQC,qBAAd,GACA,EAA0BC,oBAAS,kBAAMJ,EAAOE,EAAD,MAAZ,MAA5BxB,EAAP,KAAc2B,EAAd,KAOA,OALAC,qBAAU,WAER,OADAD,EAASL,EAAOE,EAAD,MAAfG,IACOH,EAAA,WAAgB,kBAAMG,EAASL,EAAOE,EAAD,MAArB,SACtB,CAACA,EAHJI,IAKO,CAAC5B,EAAOwB,EAAf,UAxEN,eA4EEvC,W,WACE,OAAO,kBAAMwC,qBAAW,EAAXA,SAAN,SA7EX,K,OCDaI,EAhBC,IAAI9B,EAAM,CACtBC,MAAO,CAAE8B,EAAG,EAAGC,EAAG,GAClB9B,OAAQ,CACN+B,MACE,gBAAG3C,EAAH,EAAGA,QAAH,OACA,WACEA,EAAQ,CAAEyC,EAAG,EAAGC,EAAG,MAEvBE,IACE,gBAAG/C,EAAH,EAAGA,IAAKG,EAAR,EAAQA,QAAR,OACA,SAAC6C,GACC7C,EAAQ,eAAG6C,EAAMhD,IAAMgD,GAAO,SAKPb,YAC7B,SAACrB,EAAOmC,GAAR,OAA4BnC,EAAMmC,MCjB9BX,EAAQ,IAAIzB,EAAM,CACtBG,KAAM,SACNF,OAAO,EACPC,OAHsB,YAGL,IAARd,EAAO,EAAPA,IACP,OAAO,SAACa,GAAD,OAAqBb,GAAI,SAACiD,GAAD,cAAUpC,QAAV,IAAUA,KAAUoC,SAI3CC,EAAYb,EAAMH,aAClBiB,EAAkBd,EAAMnB,kBCN/BkC,GDOyBf,EAAMvC,eCPvB,WACZ,MAA4BoD,IAA5B,mBAAOG,EAAP,KAAeC,EAAf,KAEA,OACE,+BACE,2BAAOC,KAAK,WAAWC,QAASH,EAAQI,SAAU,kBAAMH,OAD1D,kBAOEI,EAAU,SAAC,GAAmC,IAAjCV,EAAgC,EAAhCA,KACjB,EAAsBN,EAAUM,GAAhC,mBAAOW,EAAP,KAAY7C,EAAZ,KACA,OACE,4BAAQyC,KAAK,SAASK,QAAS,kBAAM9C,EAAOgC,IAAIE,KAAhD,QACQA,EADR,MACiBW,IA8BNE,EAzBH,WACV,OACE,6BACE,6BACE,kBAAC,EAAD,MACA,kBAAC,EAAD,OAGF,6BACE,kBAACV,EAAD,CAAiBtC,OAAO,GACtB,kBAAC,EAAD,OAEF,kBAACsC,EAAD,CAAiBtC,OAAO,GACtB,kBAAC,EAAD,QAIJ,6BACE,kBAAC,EAAD,CAASmC,KAAK,MACd,kBAAC,EAAD,CAASA,KAAK,SCtCtBc,IAASlC,OAAO,kBAAC,EAAD,MAASmC,SAASC,eAAe,U","file":"static/js/main.8a5e4d8a.chunk.js","sourcesContent":["import { SetStateAction } from 'react'\nimport { ValueChanged } from './Notifier'\nimport { ShallowSetStateAction, StoreApi } from './type'\n\nexport class Subscriber<V, A> extends ValueChanged<V> {\n  action: A\n\n  get api() {\n    return {\n      get: () => this.value,\n      set: (value: SetStateAction<V>) => {\n        if (value instanceof Function) this.value = value(this.value)\n        else this.value = value\n      },\n      shallow: (value: ShallowSetStateAction<V>) => {\n        let nextValue: Partial<V>\n        if (value instanceof Function) nextValue = value(this.value)\n        else nextValue = value\n        const changed = Object.keys(nextValue).find((key) => {\n          return nextValue[key] !== this.value[key]\n        })\n        if (changed) {\n          this.value = Object.assign({}, this.value, nextValue)\n        }\n      }\n    }\n  }\n\n  constructor(value: V, createAction: (api: StoreApi<V>) => A) {\n    super(value)\n    this.action = createAction(this.api)\n  }\n}\n","type Listener = () => void\n\nexport class Notifier {\n  private _listens: Listener[] = []\n\n  get hasListen(): boolean {\n    return Boolean(this._listens.length)\n  }\n\n  addListen(listener: Listener): () => void {\n    this._listens.push(listener)\n    return () => {\n      this._listens.splice(this._listens.indexOf(listener), 1)\n    }\n  }\n\n  protected notify(): void {\n    this._listens.forEach((listener) => listener())\n  }\n}\n\nexport class ValueChanged<V> extends Notifier {\n  constructor(private _value: V) {\n    super()\n  }\n\n  get value(): V {\n    return this._value\n  }\n\n  set value(value: V) {\n    if (this._value === value) return\n    this._value = value\n    this.notify()\n  }\n}\n","import {\n  Component,\n  Context,\n  createContext,\n  createElement,\n  useContext,\n  useEffect,\n  useState\n} from 'react'\n\nimport {\n  StoreProps,\n  HookSelector,\n  ContainerLifeCycle,\n  ContainerLifePoint,\n  ActionCreator\n} from './type'\nimport { Subscriber } from './Subscriber'\n\nexport class Store<State, Action> {\n  private Context: Context<Subscriber<State, Action>>\n  private _createAction: ActionCreator<State, Action>\n\n  constructor({ state, action, name }: StoreProps<State, Action>) {\n    if (typeof action === 'function') {\n      this._createAction = action\n    } else {\n      this._createAction = (api) => {\n        const actions = {} as Action\n        Object.keys(action).forEach((key) => {\n          actions[key] = action[key](api)\n        })\n        return actions\n      }\n    }\n    this.Context = createContext(new Subscriber(state, this._createAction))\n    this.Context.displayName = name\n  }\n\n  createContainer(cycle: ContainerLifeCycle<State, Action> = {}) {\n    const { Context, _createAction } = this\n    type Props = { state: State }\n\n    return class extends Component<Props> {\n      static displayName = Context.displayName\n      store: Subscriber<State, Action>\n      constructor(props: Props) {\n        super(props)\n        this.store = new Subscriber(props.state, _createAction)\n        this.firePoint(cycle.create)\n      }\n\n      firePoint = (fire?: ContainerLifePoint<State, Action>) => {\n        fire && fire(this.store.api, this.store.action)\n      }\n\n      shouldComponentUpdate(next: Props) {\n        if (next.state !== this.props.state) {\n          this.store.value = next.state\n          this.firePoint(cycle.update)\n          return true\n        }\n        return false\n      }\n\n      componentWillUnmount() {\n        this.firePoint(cycle.dispose)\n      }\n\n      render() {\n        const { children } = this.props\n        return createElement(Context.Provider, { value: this.store, children })\n      }\n    }\n  }\n\n  createHook<Value = State, Flag = void>(\n    selector?: HookSelector<State, Value, Flag>\n  ) {\n    const { Context } = this\n    type Select = (state: State, flag: Flag) => Value\n    const select = (selector || ((v) => v)) as Select\n    return (flag: Flag): [Value, Action] => {\n      const store = useContext(Context)\n      const [state, setState] = useState(() => select(store.value, flag))\n\n      useEffect(() => {\n        setState(select(store.value, flag))\n        return store.addListen(() => setState(select(store.value, flag)))\n      }, [store, flag])\n\n      return [state, store.action]\n    }\n  }\n\n  createAction() {\n    return () => useContext(this.Context).action\n  }\n}\n","import { Store } from 'react-context-state'\n\nconst store = new Store({\n  state: { a: 0, b: 0 },\n  action: {\n    reset:\n      ({ shallow }) =>\n      () => {\n        shallow({ a: 0, b: 0 })\n      },\n    add:\n      ({ get, shallow }) =>\n      (key: 'a' | 'b') => {\n        shallow({ [key]: get()[key] + 1 })\n      }\n  }\n})\n\nexport const useObject = store.createHook(\n  (state, flag: 'a' | 'b') => state[flag]\n)\n","import { Store } from 'react-context-state'\n\nconst store = new Store({\n  name: 'Toggle',\n  state: false,\n  action({ set }) {\n    return (state?: boolean) => set((prev) => state ?? !prev)\n  }\n})\n\nexport const useToggle = store.createHook()\nexport const ToggleContainer = store.createContainer()\nexport const useToggleAction = store.createAction()\n","import React from 'react'\nimport {} from 'react-context-state'\nimport { useObject } from './Store.object'\nimport { ToggleContainer, useToggle } from './Store.toggle'\n\nconst Check = () => {\n  const [toggle, setToggle] = useToggle()\n\n  return (\n    <label>\n      <input type='checkbox' checked={toggle} onChange={() => setToggle()} />\n      Toggle store\n    </label>\n  )\n}\n\nconst Counter = ({ flag }: { flag: 'a' | 'b' }) => {\n  const [num, action] = useObject(flag)\n  return (\n    <button type='button' onClick={() => action.add(flag)}>\n      Num \"{flag}\": {num}\n    </button>\n  )\n}\n\nconst App = () => {\n  return (\n    <div>\n      <div>\n        <Check />\n        <Check />\n      </div>\n\n      <div>\n        <ToggleContainer state={true}>\n          <Check />\n        </ToggleContainer>\n        <ToggleContainer state={false}>\n          <Check />\n        </ToggleContainer>\n      </div>\n\n      <div>\n        <Counter flag='a' />\n        <Counter flag='b' />\n      </div>\n    </div>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}